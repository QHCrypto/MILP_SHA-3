// the array linearlayer_CP and linearlayer must match the width !!!
#include <iostream>
#include <fstream>
#include <algorithm>
#include <vector>
#include <cassert>
#include <chrono>
#include <csignal>
#include <gurobi_c++.h>
#define threads 8
using namespace std;
const vector<int> linearlayer_CP = { 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,100,101,102,103,104,105,106,107,108,109,110,111,96,97,98,99,197,198,199,200,201,202,203,204,205,206,207,192,193,194,195,196,299,300,301,302,303,288,289,290,291,292,293,294,295,296,297,298,386,387,388,389,390,391,392,393,394,395,396,397,398,399,384,385,52,53,54,55,56,57,58,59,60,61,62,63,48,49,50,51,156,157,158,159,144,145,146,147,148,149,150,151,152,153,154,155,173,174,175,160,161,162,163,164,165,166,167,168,169,170,171,172,259,260,261,262,263,264,265,266,267,268,269,270,271,256,257,258,355,356,357,358,359,360,361,362,363,364,365,366,367,352,353,354,31,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,122,123,124,125,126,127,112,113,114,115,116,117,118,119,120,121,215,216,217,218,219,220,221,222,223,208,209,210,211,212,213,214,312,313,314,315,316,317,318,319,304,305,306,307,308,309,310,311,334,335,320,321,322,323,324,325,326,327,328,329,330,331,332,333,69,70,71,72,73,74,75,76,77,78,79,64,65,66,67,68,92,93,94,95,80,81,82,83,84,85,86,87,88,89,90,91,182,183,184,185,186,187,188,189,190,191,176,177,178,179,180,181,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,272,376,377,378,379,380,381,382,383,368,369,370,371,372,373,374,375,34,35,36,37,38,39,40,41,42,43,44,45,46,47,32,33,137,138,139,140,141,142,143,128,129,130,131,132,133,134,135,136,233,234,235,236,237,238,239,224,225,226,227,228,229,230,231,232,247,248,249,250,251,252,253,254,255,240,241,242,243,244,245,246,350,351,336,337,338,339,340,341,342,343,344,345,346,347,348,349 };
const vector<vector<int>> linearlayer = { {{0, 31, 64, 111, 144, 191, 224, 271, 304, 351, 384}, {1, 16, 65, 96, 145, 176, 225, 256, 305, 336, 385}, {2, 17, 66, 97, 146, 177, 226, 257, 306, 337, 386}, {3, 18, 67, 98, 147, 178, 227, 258, 307, 338, 387}, {4, 19, 68, 99, 148, 179, 228, 259, 308, 339, 388}, {5, 20, 69, 100, 149, 180, 229, 260, 309, 340, 389}, {6, 21, 70, 101, 150, 181, 230, 261, 310, 341, 390}, {7, 22, 71, 102, 151, 182, 231, 262, 311, 342, 391}, {8, 23, 72, 103, 152, 183, 232, 263, 312, 343, 392}, {9, 24, 73, 104, 153, 184, 233, 264, 313, 344, 393}, {10, 25, 74, 105, 154, 185, 234, 265, 314, 345, 394}, {11, 26, 75, 106, 155, 186, 235, 266, 315, 346, 395}, {12, 27, 76, 107, 156, 187, 236, 267, 316, 347, 396}, {13, 28, 77, 108, 157, 188, 237, 268, 317, 348, 397}, {14, 29, 78, 109, 158, 189, 238, 269, 318, 349, 398}, {15, 30, 79, 110, 159, 190, 239, 270, 319, 350, 399}, {4, 35, 84, 100, 115, 164, 195, 244, 275, 324, 355}, {5, 36, 85, 101, 116, 165, 196, 245, 276, 325, 356}, {6, 37, 86, 102, 117, 166, 197, 246, 277, 326, 357}, {7, 38, 87, 103, 118, 167, 198, 247, 278, 327, 358}, {8, 39, 88, 104, 119, 168, 199, 248, 279, 328, 359}, {9, 40, 89, 105, 120, 169, 200, 249, 280, 329, 360}, {10, 41, 90, 106, 121, 170, 201, 250, 281, 330, 361}, {11, 42, 91, 107, 122, 171, 202, 251, 282, 331, 362}, {12, 43, 92, 108, 123, 172, 203, 252, 283, 332, 363}, {13, 44, 93, 109, 124, 173, 204, 253, 284, 333, 364}, {14, 45, 94, 110, 125, 174, 205, 254, 285, 334, 365}, {15, 46, 95, 111, 126, 175, 206, 255, 286, 335, 366}, {0, 47, 80, 96, 127, 160, 207, 240, 287, 320, 367}, {1, 32, 81, 97, 112, 161, 192, 241, 272, 321, 352}, {2, 33, 82, 98, 113, 162, 193, 242, 273, 322, 353}, {3, 34, 83, 99, 114, 163, 194, 243, 274, 323, 354}, {21, 52, 101, 132, 181, 197, 212, 261, 292, 341, 372}, {22, 53, 102, 133, 182, 198, 213, 262, 293, 342, 373}, {23, 54, 103, 134, 183, 199, 214, 263, 294, 343, 374}, {24, 55, 104, 135, 184, 200, 215, 264, 295, 344, 375}, {25, 56, 105, 136, 185, 201, 216, 265, 296, 345, 376}, {26, 57, 106, 137, 186, 202, 217, 266, 297, 346, 377}, {27, 58, 107, 138, 187, 203, 218, 267, 298, 347, 378}, {28, 59, 108, 139, 188, 204, 219, 268, 299, 348, 379}, {29, 60, 109, 140, 189, 205, 220, 269, 300, 349, 380}, {30, 61, 110, 141, 190, 206, 221, 270, 301, 350, 381}, {31, 62, 111, 142, 191, 207, 222, 271, 302, 351, 382}, {16, 63, 96, 143, 176, 192, 223, 256, 303, 336, 383}, {17, 48, 97, 128, 177, 193, 208, 257, 288, 337, 368}, {18, 49, 98, 129, 178, 194, 209, 258, 289, 338, 369}, {19, 50, 99, 130, 179, 195, 210, 259, 290, 339, 370}, {20, 51, 100, 131, 180, 196, 211, 260, 291, 340, 371}, {43, 74, 123, 154, 203, 234, 283, 299, 314, 363, 394}, {44, 75, 124, 155, 204, 235, 284, 300, 315, 364, 395}, {45, 76, 125, 156, 205, 236, 285, 301, 316, 365, 396}, {46, 77, 126, 157, 206, 237, 286, 302, 317, 366, 397}, {47, 78, 127, 158, 207, 238, 287, 303, 318, 367, 398}, {32, 79, 112, 159, 192, 239, 272, 288, 319, 352, 399}, {33, 64, 113, 144, 193, 224, 273, 289, 304, 353, 384}, {34, 65, 114, 145, 194, 225, 274, 290, 305, 354, 385}, {35, 66, 115, 146, 195, 226, 275, 291, 306, 355, 386}, {36, 67, 116, 147, 196, 227, 276, 292, 307, 356, 387}, {37, 68, 117, 148, 197, 228, 277, 293, 308, 357, 388}, {38, 69, 118, 149, 198, 229, 278, 294, 309, 358, 389}, {39, 70, 119, 150, 199, 230, 279, 295, 310, 359, 390}, {40, 71, 120, 151, 200, 231, 280, 296, 311, 360, 391}, {41, 72, 121, 152, 201, 232, 281, 297, 312, 361, 392}, {42, 73, 122, 153, 202, 233, 282, 298, 313, 362, 393}, {1, 50, 81, 130, 161, 210, 241, 290, 321, 370, 386}, {2, 51, 82, 131, 162, 211, 242, 291, 322, 371, 387}, {3, 52, 83, 132, 163, 212, 243, 292, 323, 372, 388}, {4, 53, 84, 133, 164, 213, 244, 293, 324, 373, 389}, {5, 54, 85, 134, 165, 214, 245, 294, 325, 374, 390}, {6, 55, 86, 135, 166, 215, 246, 295, 326, 375, 391}, {7, 56, 87, 136, 167, 216, 247, 296, 327, 376, 392}, {8, 57, 88, 137, 168, 217, 248, 297, 328, 377, 393}, {9, 58, 89, 138, 169, 218, 249, 298, 329, 378, 394}, {10, 59, 90, 139, 170, 219, 250, 299, 330, 379, 395}, {11, 60, 91, 140, 171, 220, 251, 300, 331, 380, 396}, {12, 61, 92, 141, 172, 221, 252, 301, 332, 381, 397}, {13, 62, 93, 142, 173, 222, 253, 302, 333, 382, 398}, {14, 63, 94, 143, 174, 223, 254, 303, 334, 383, 399}, {15, 48, 95, 128, 175, 208, 255, 288, 335, 368, 384}, {0, 49, 80, 129, 160, 209, 240, 289, 320, 369, 385}, {36, 52, 67, 116, 147, 196, 227, 276, 307, 356, 387}, {37, 53, 68, 117, 148, 197, 228, 277, 308, 357, 388}, {38, 54, 69, 118, 149, 198, 229, 278, 309, 358, 389}, {39, 55, 70, 119, 150, 199, 230, 279, 310, 359, 390}, {40, 56, 71, 120, 151, 200, 231, 280, 311, 360, 391}, {41, 57, 72, 121, 152, 201, 232, 281, 312, 361, 392}, {42, 58, 73, 122, 153, 202, 233, 282, 313, 362, 393}, {43, 59, 74, 123, 154, 203, 234, 283, 314, 363, 394}, {44, 60, 75, 124, 155, 204, 235, 284, 315, 364, 395}, {45, 61, 76, 125, 156, 205, 236, 285, 316, 365, 396}, {46, 62, 77, 126, 157, 206, 237, 286, 317, 366, 397}, {47, 63, 78, 127, 158, 207, 238, 287, 318, 367, 398}, {32, 48, 79, 112, 159, 192, 239, 272, 319, 352, 399}, {33, 49, 64, 113, 144, 193, 224, 273, 304, 353, 384}, {34, 50, 65, 114, 145, 194, 225, 274, 305, 354, 385}, {35, 51, 66, 115, 146, 195, 226, 275, 306, 355, 386}, {11, 60, 91, 140, 156, 171, 220, 251, 300, 331, 380}, {12, 61, 92, 141, 157, 172, 221, 252, 301, 332, 381}, {13, 62, 93, 142, 158, 173, 222, 253, 302, 333, 382}, {14, 63, 94, 143, 159, 174, 223, 254, 303, 334, 383}, {15, 48, 95, 128, 144, 175, 208, 255, 288, 335, 368}, {0, 49, 80, 129, 145, 160, 209, 240, 289, 320, 369}, {1, 50, 81, 130, 146, 161, 210, 241, 290, 321, 370}, {2, 51, 82, 131, 147, 162, 211, 242, 291, 322, 371}, {3, 52, 83, 132, 148, 163, 212, 243, 292, 323, 372}, {4, 53, 84, 133, 149, 164, 213, 244, 293, 324, 373}, {5, 54, 85, 134, 150, 165, 214, 245, 294, 325, 374}, {6, 55, 86, 135, 151, 166, 215, 246, 295, 326, 375}, {7, 56, 87, 136, 152, 167, 216, 247, 296, 327, 376}, {8, 57, 88, 137, 153, 168, 217, 248, 297, 328, 377}, {9, 58, 89, 138, 154, 169, 218, 249, 298, 329, 378}, {10, 59, 90, 139, 155, 170, 219, 250, 299, 330, 379}, {28, 77, 108, 157, 173, 188, 237, 268, 317, 348, 397}, {29, 78, 109, 158, 174, 189, 238, 269, 318, 349, 398}, {30, 79, 110, 159, 175, 190, 239, 270, 319, 350, 399}, {31, 64, 111, 144, 160, 191, 224, 271, 304, 351, 384}, {16, 65, 96, 145, 161, 176, 225, 256, 305, 336, 385}, {17, 66, 97, 146, 162, 177, 226, 257, 306, 337, 386}, {18, 67, 98, 147, 163, 178, 227, 258, 307, 338, 387}, {19, 68, 99, 148, 164, 179, 228, 259, 308, 339, 388}, {20, 69, 100, 149, 165, 180, 229, 260, 309, 340, 389}, {21, 70, 101, 150, 166, 181, 230, 261, 310, 341, 390}, {22, 71, 102, 151, 167, 182, 231, 262, 311, 342, 391}, {23, 72, 103, 152, 168, 183, 232, 263, 312, 343, 392}, {24, 73, 104, 153, 169, 184, 233, 264, 313, 344, 393}, {25, 74, 105, 154, 170, 185, 234, 265, 314, 345, 394}, {26, 75, 106, 155, 171, 186, 235, 266, 315, 346, 395}, {27, 76, 107, 156, 172, 187, 236, 267, 316, 347, 396}, {3, 34, 83, 114, 163, 194, 243, 259, 274, 323, 354}, {4, 35, 84, 115, 164, 195, 244, 260, 275, 324, 355}, {5, 36, 85, 116, 165, 196, 245, 261, 276, 325, 356}, {6, 37, 86, 117, 166, 197, 246, 262, 277, 326, 357}, {7, 38, 87, 118, 167, 198, 247, 263, 278, 327, 358}, {8, 39, 88, 119, 168, 199, 248, 264, 279, 328, 359}, {9, 40, 89, 120, 169, 200, 249, 265, 280, 329, 360}, {10, 41, 90, 121, 170, 201, 250, 266, 281, 330, 361}, {11, 42, 91, 122, 171, 202, 251, 267, 282, 331, 362}, {12, 43, 92, 123, 172, 203, 252, 268, 283, 332, 363}, {13, 44, 93, 124, 173, 204, 253, 269, 284, 333, 364}, {14, 45, 94, 125, 174, 205, 254, 270, 285, 334, 365}, {15, 46, 95, 126, 175, 206, 255, 271, 286, 335, 366}, {0, 47, 80, 127, 160, 207, 240, 256, 287, 320, 367}, {1, 32, 81, 112, 161, 192, 241, 257, 272, 321, 352}, {2, 33, 82, 113, 162, 193, 242, 258, 273, 322, 353}, {19, 50, 99, 130, 179, 210, 259, 290, 339, 355, 370}, {20, 51, 100, 131, 180, 211, 260, 291, 340, 356, 371}, {21, 52, 101, 132, 181, 212, 261, 292, 341, 357, 372}, {22, 53, 102, 133, 182, 213, 262, 293, 342, 358, 373}, {23, 54, 103, 134, 183, 214, 263, 294, 343, 359, 374}, {24, 55, 104, 135, 184, 215, 264, 295, 344, 360, 375}, {25, 56, 105, 136, 185, 216, 265, 296, 345, 361, 376}, {26, 57, 106, 137, 186, 217, 266, 297, 346, 362, 377}, {27, 58, 107, 138, 187, 218, 267, 298, 347, 363, 378}, {28, 59, 108, 139, 188, 219, 268, 299, 348, 364, 379}, {29, 60, 109, 140, 189, 220, 269, 300, 349, 365, 380}, {30, 61, 110, 141, 190, 221, 270, 301, 350, 366, 381}, {31, 62, 111, 142, 191, 222, 271, 302, 351, 367, 382}, {16, 63, 96, 143, 176, 223, 256, 303, 336, 352, 383}, {17, 48, 97, 128, 177, 208, 257, 288, 337, 353, 368}, {18, 49, 98, 129, 178, 209, 258, 289, 338, 354, 369}, {15, 31, 46, 95, 126, 175, 206, 255, 286, 335, 366}, {0, 16, 47, 80, 127, 160, 207, 240, 287, 320, 367}, {1, 17, 32, 81, 112, 161, 192, 241, 272, 321, 352}, {2, 18, 33, 82, 113, 162, 193, 242, 273, 322, 353}, {3, 19, 34, 83, 114, 163, 194, 243, 274, 323, 354}, {4, 20, 35, 84, 115, 164, 195, 244, 275, 324, 355}, {5, 21, 36, 85, 116, 165, 196, 245, 276, 325, 356}, {6, 22, 37, 86, 117, 166, 197, 246, 277, 326, 357}, {7, 23, 38, 87, 118, 167, 198, 247, 278, 327, 358}, {8, 24, 39, 88, 119, 168, 199, 248, 279, 328, 359}, {9, 25, 40, 89, 120, 169, 200, 249, 280, 329, 360}, {10, 26, 41, 90, 121, 170, 201, 250, 281, 330, 361}, {11, 27, 42, 91, 122, 171, 202, 251, 282, 331, 362}, {12, 28, 43, 92, 123, 172, 203, 252, 283, 332, 363}, {13, 29, 44, 93, 124, 173, 204, 253, 284, 333, 364}, {14, 30, 45, 94, 125, 174, 205, 254, 285, 334, 365}, {26, 57, 106, 122, 137, 186, 217, 266, 297, 346, 377}, {27, 58, 107, 123, 138, 187, 218, 267, 298, 347, 378}, {28, 59, 108, 124, 139, 188, 219, 268, 299, 348, 379}, {29, 60, 109, 125, 140, 189, 220, 269, 300, 349, 380}, {30, 61, 110, 126, 141, 190, 221, 270, 301, 350, 381}, {31, 62, 111, 127, 142, 191, 222, 271, 302, 351, 382}, {16, 63, 96, 112, 143, 176, 223, 256, 303, 336, 383}, {17, 48, 97, 113, 128, 177, 208, 257, 288, 337, 368}, {18, 49, 98, 114, 129, 178, 209, 258, 289, 338, 369}, {19, 50, 99, 115, 130, 179, 210, 259, 290, 339, 370}, {20, 51, 100, 116, 131, 180, 211, 260, 291, 340, 371}, {21, 52, 101, 117, 132, 181, 212, 261, 292, 341, 372}, {22, 53, 102, 118, 133, 182, 213, 262, 293, 342, 373}, {23, 54, 103, 119, 134, 183, 214, 263, 294, 343, 374}, {24, 55, 104, 120, 135, 184, 215, 264, 295, 344, 375}, {25, 56, 105, 121, 136, 185, 216, 265, 296, 345, 376}, {39, 70, 119, 150, 199, 215, 230, 279, 310, 359, 390}, {40, 71, 120, 151, 200, 216, 231, 280, 311, 360, 391}, {41, 72, 121, 152, 201, 217, 232, 281, 312, 361, 392}, {42, 73, 122, 153, 202, 218, 233, 282, 313, 362, 393}, {43, 74, 123, 154, 203, 219, 234, 283, 314, 363, 394}, {44, 75, 124, 155, 204, 220, 235, 284, 315, 364, 395}, {45, 76, 125, 156, 205, 221, 236, 285, 316, 365, 396}, {46, 77, 126, 157, 206, 222, 237, 286, 317, 366, 397}, {47, 78, 127, 158, 207, 223, 238, 287, 318, 367, 398}, {32, 79, 112, 159, 192, 208, 239, 272, 319, 352, 399}, {33, 64, 113, 144, 193, 209, 224, 273, 304, 353, 384}, {34, 65, 114, 145, 194, 210, 225, 274, 305, 354, 385}, {35, 66, 115, 146, 195, 211, 226, 275, 306, 355, 386}, {36, 67, 116, 147, 196, 212, 227, 276, 307, 356, 387}, {37, 68, 117, 148, 197, 213, 228, 277, 308, 357, 388}, {38, 69, 118, 149, 198, 214, 229, 278, 309, 358, 389}, {7, 56, 87, 136, 167, 216, 247, 296, 312, 327, 376}, {8, 57, 88, 137, 168, 217, 248, 297, 313, 328, 377}, {9, 58, 89, 138, 169, 218, 249, 298, 314, 329, 378}, {10, 59, 90, 139, 170, 219, 250, 299, 315, 330, 379}, {11, 60, 91, 140, 171, 220, 251, 300, 316, 331, 380}, {12, 61, 92, 141, 172, 221, 252, 301, 317, 332, 381}, {13, 62, 93, 142, 173, 222, 253, 302, 318, 333, 382}, {14, 63, 94, 143, 174, 223, 254, 303, 319, 334, 383}, {15, 48, 95, 128, 175, 208, 255, 288, 304, 335, 368}, {0, 49, 80, 129, 160, 209, 240, 289, 305, 320, 369}, {1, 50, 81, 130, 161, 210, 241, 290, 306, 321, 370}, {2, 51, 82, 131, 162, 211, 242, 291, 307, 322, 371}, {3, 52, 83, 132, 163, 212, 243, 292, 308, 323, 372}, {4, 53, 84, 133, 164, 213, 244, 293, 309, 324, 373}, {5, 54, 85, 134, 165, 214, 245, 294, 310, 325, 374}, {6, 55, 86, 135, 166, 215, 246, 295, 311, 326, 375}, {29, 78, 109, 158, 189, 238, 269, 318, 334, 349, 398}, {30, 79, 110, 159, 190, 239, 270, 319, 335, 350, 399}, {31, 64, 111, 144, 191, 224, 271, 304, 320, 351, 384}, {16, 65, 96, 145, 176, 225, 256, 305, 321, 336, 385}, {17, 66, 97, 146, 177, 226, 257, 306, 322, 337, 386}, {18, 67, 98, 147, 178, 227, 258, 307, 323, 338, 387}, {19, 68, 99, 148, 179, 228, 259, 308, 324, 339, 388}, {20, 69, 100, 149, 180, 229, 260, 309, 325, 340, 389}, {21, 70, 101, 150, 181, 230, 261, 310, 326, 341, 390}, {22, 71, 102, 151, 182, 231, 262, 311, 327, 342, 391}, {23, 72, 103, 152, 183, 232, 263, 312, 328, 343, 392}, {24, 73, 104, 153, 184, 233, 264, 313, 329, 344, 393}, {25, 74, 105, 154, 185, 234, 265, 314, 330, 345, 394}, {26, 75, 106, 155, 186, 235, 266, 315, 331, 346, 395}, {27, 76, 107, 156, 187, 236, 267, 316, 332, 347, 396}, {28, 77, 108, 157, 188, 237, 268, 317, 333, 348, 397}, {4, 53, 69, 84, 133, 164, 213, 244, 293, 324, 373}, {5, 54, 70, 85, 134, 165, 214, 245, 294, 325, 374}, {6, 55, 71, 86, 135, 166, 215, 246, 295, 326, 375}, {7, 56, 72, 87, 136, 167, 216, 247, 296, 327, 376}, {8, 57, 73, 88, 137, 168, 217, 248, 297, 328, 377}, {9, 58, 74, 89, 138, 169, 218, 249, 298, 329, 378}, {10, 59, 75, 90, 139, 170, 219, 250, 299, 330, 379}, {11, 60, 76, 91, 140, 171, 220, 251, 300, 331, 380}, {12, 61, 77, 92, 141, 172, 221, 252, 301, 332, 381}, {13, 62, 78, 93, 142, 173, 222, 253, 302, 333, 382}, {14, 63, 79, 94, 143, 174, 223, 254, 303, 334, 383}, {15, 48, 64, 95, 128, 175, 208, 255, 288, 335, 368}, {0, 49, 65, 80, 129, 160, 209, 240, 289, 320, 369}, {1, 50, 66, 81, 130, 161, 210, 241, 290, 321, 370}, {2, 51, 67, 82, 131, 162, 211, 242, 291, 322, 371}, {3, 52, 68, 83, 132, 163, 212, 243, 292, 323, 372}, {27, 76, 92, 107, 156, 187, 236, 267, 316, 347, 396}, {28, 77, 93, 108, 157, 188, 237, 268, 317, 348, 397}, {29, 78, 94, 109, 158, 189, 238, 269, 318, 349, 398}, {30, 79, 95, 110, 159, 190, 239, 270, 319, 350, 399}, {31, 64, 80, 111, 144, 191, 224, 271, 304, 351, 384}, {16, 65, 81, 96, 145, 176, 225, 256, 305, 336, 385}, {17, 66, 82, 97, 146, 177, 226, 257, 306, 337, 386}, {18, 67, 83, 98, 147, 178, 227, 258, 307, 338, 387}, {19, 68, 84, 99, 148, 179, 228, 259, 308, 339, 388}, {20, 69, 85, 100, 149, 180, 229, 260, 309, 340, 389}, {21, 70, 86, 101, 150, 181, 230, 261, 310, 341, 390}, {22, 71, 87, 102, 151, 182, 231, 262, 311, 342, 391}, {23, 72, 88, 103, 152, 183, 232, 263, 312, 343, 392}, {24, 73, 89, 104, 153, 184, 233, 264, 313, 344, 393}, {25, 74, 90, 105, 154, 185, 234, 265, 314, 345, 394}, {26, 75, 91, 106, 155, 186, 235, 266, 315, 346, 395}, {6, 37, 86, 117, 166, 182, 197, 246, 277, 326, 357}, {7, 38, 87, 118, 167, 183, 198, 247, 278, 327, 358}, {8, 39, 88, 119, 168, 184, 199, 248, 279, 328, 359}, {9, 40, 89, 120, 169, 185, 200, 249, 280, 329, 360}, {10, 41, 90, 121, 170, 186, 201, 250, 281, 330, 361}, {11, 42, 91, 122, 171, 187, 202, 251, 282, 331, 362}, {12, 43, 92, 123, 172, 188, 203, 252, 283, 332, 363}, {13, 44, 93, 124, 173, 189, 204, 253, 284, 333, 364}, {14, 45, 94, 125, 174, 190, 205, 254, 285, 334, 365}, {15, 46, 95, 126, 175, 191, 206, 255, 286, 335, 366}, {0, 47, 80, 127, 160, 176, 207, 240, 287, 320, 367}, {1, 32, 81, 112, 161, 177, 192, 241, 272, 321, 352}, {2, 33, 82, 113, 162, 178, 193, 242, 273, 322, 353}, {3, 34, 83, 114, 163, 179, 194, 243, 274, 323, 354}, {4, 35, 84, 115, 164, 180, 195, 244, 275, 324, 355}, {5, 36, 85, 116, 165, 181, 196, 245, 276, 325, 356}, {17, 48, 97, 128, 177, 208, 257, 273, 288, 337, 368}, {18, 49, 98, 129, 178, 209, 258, 274, 289, 338, 369}, {19, 50, 99, 130, 179, 210, 259, 275, 290, 339, 370}, {20, 51, 100, 131, 180, 211, 260, 276, 291, 340, 371}, {21, 52, 101, 132, 181, 212, 261, 277, 292, 341, 372}, {22, 53, 102, 133, 182, 213, 262, 278, 293, 342, 373}, {23, 54, 103, 134, 183, 214, 263, 279, 294, 343, 374}, {24, 55, 104, 135, 184, 215, 264, 280, 295, 344, 375}, {25, 56, 105, 136, 185, 216, 265, 281, 296, 345, 376}, {26, 57, 106, 137, 186, 217, 266, 282, 297, 346, 377}, {27, 58, 107, 138, 187, 218, 267, 283, 298, 347, 378}, {28, 59, 108, 139, 188, 219, 268, 284, 299, 348, 379}, {29, 60, 109, 140, 189, 220, 269, 285, 300, 349, 380}, {30, 61, 110, 141, 190, 221, 270, 286, 301, 350, 381}, {31, 62, 111, 142, 191, 222, 271, 287, 302, 351, 382}, {16, 63, 96, 143, 176, 223, 256, 272, 303, 336, 383}, {40, 71, 120, 151, 200, 231, 280, 311, 360, 376, 391}, {41, 72, 121, 152, 201, 232, 281, 312, 361, 377, 392}, {42, 73, 122, 153, 202, 233, 282, 313, 362, 378, 393}, {43, 74, 123, 154, 203, 234, 283, 314, 363, 379, 394}, {44, 75, 124, 155, 204, 235, 284, 315, 364, 380, 395}, {45, 76, 125, 156, 205, 236, 285, 316, 365, 381, 396}, {46, 77, 126, 157, 206, 237, 286, 317, 366, 382, 397}, {47, 78, 127, 158, 207, 238, 287, 318, 367, 383, 398}, {32, 79, 112, 159, 192, 239, 272, 319, 352, 368, 399}, {33, 64, 113, 144, 193, 224, 273, 304, 353, 369, 384}, {34, 65, 114, 145, 194, 225, 274, 305, 354, 370, 385}, {35, 66, 115, 146, 195, 226, 275, 306, 355, 371, 386}, {36, 67, 116, 147, 196, 227, 276, 307, 356, 372, 387}, {37, 68, 117, 148, 197, 228, 277, 308, 357, 373, 388}, {38, 69, 118, 149, 198, 229, 278, 309, 358, 374, 389}, {39, 70, 119, 150, 199, 230, 279, 310, 359, 375, 390}, {18, 34, 49, 98, 129, 178, 209, 258, 289, 338, 369}, {19, 35, 50, 99, 130, 179, 210, 259, 290, 339, 370}, {20, 36, 51, 100, 131, 180, 211, 260, 291, 340, 371}, {21, 37, 52, 101, 132, 181, 212, 261, 292, 341, 372}, {22, 38, 53, 102, 133, 182, 213, 262, 293, 342, 373}, {23, 39, 54, 103, 134, 183, 214, 263, 294, 343, 374}, {24, 40, 55, 104, 135, 184, 215, 264, 295, 344, 375}, {25, 41, 56, 105, 136, 185, 216, 265, 296, 345, 376}, {26, 42, 57, 106, 137, 186, 217, 266, 297, 346, 377}, {27, 43, 58, 107, 138, 187, 218, 267, 298, 347, 378}, {28, 44, 59, 108, 139, 188, 219, 268, 299, 348, 379}, {29, 45, 60, 109, 140, 189, 220, 269, 300, 349, 380}, {30, 46, 61, 110, 141, 190, 221, 270, 301, 350, 381}, {31, 47, 62, 111, 142, 191, 222, 271, 302, 351, 382}, {16, 32, 63, 96, 143, 176, 223, 256, 303, 336, 383}, {17, 33, 48, 97, 128, 177, 208, 257, 288, 337, 368}, {41, 72, 121, 137, 152, 201, 232, 281, 312, 361, 392}, {42, 73, 122, 138, 153, 202, 233, 282, 313, 362, 393}, {43, 74, 123, 139, 154, 203, 234, 283, 314, 363, 394}, {44, 75, 124, 140, 155, 204, 235, 284, 315, 364, 395}, {45, 76, 125, 141, 156, 205, 236, 285, 316, 365, 396}, {46, 77, 126, 142, 157, 206, 237, 286, 317, 366, 397}, {47, 78, 127, 143, 158, 207, 238, 287, 318, 367, 398}, {32, 79, 112, 128, 159, 192, 239, 272, 319, 352, 399}, {33, 64, 113, 129, 144, 193, 224, 273, 304, 353, 384}, {34, 65, 114, 130, 145, 194, 225, 274, 305, 354, 385}, {35, 66, 115, 131, 146, 195, 226, 275, 306, 355, 386}, {36, 67, 116, 132, 147, 196, 227, 276, 307, 356, 387}, {37, 68, 117, 133, 148, 197, 228, 277, 308, 357, 388}, {38, 69, 118, 134, 149, 198, 229, 278, 309, 358, 389}, {39, 70, 119, 135, 150, 199, 230, 279, 310, 359, 390}, {40, 71, 120, 136, 151, 200, 231, 280, 311, 360, 391}, {8, 57, 88, 137, 168, 217, 233, 248, 297, 328, 377}, {9, 58, 89, 138, 169, 218, 234, 249, 298, 329, 378}, {10, 59, 90, 139, 170, 219, 235, 250, 299, 330, 379}, {11, 60, 91, 140, 171, 220, 236, 251, 300, 331, 380}, {12, 61, 92, 141, 172, 221, 237, 252, 301, 332, 381}, {13, 62, 93, 142, 173, 222, 238, 253, 302, 333, 382}, {14, 63, 94, 143, 174, 223, 239, 254, 303, 334, 383}, {15, 48, 95, 128, 175, 208, 224, 255, 288, 335, 368}, {0, 49, 80, 129, 160, 209, 225, 240, 289, 320, 369}, {1, 50, 81, 130, 161, 210, 226, 241, 290, 321, 370}, {2, 51, 82, 131, 162, 211, 227, 242, 291, 322, 371}, {3, 52, 83, 132, 163, 212, 228, 243, 292, 323, 372}, {4, 53, 84, 133, 164, 213, 229, 244, 293, 324, 373}, {5, 54, 85, 134, 165, 214, 230, 245, 294, 325, 374}, {6, 55, 86, 135, 166, 215, 231, 246, 295, 326, 375}, {7, 56, 87, 136, 167, 216, 232, 247, 296, 327, 376}, {22, 71, 102, 151, 182, 231, 247, 262, 311, 342, 391}, {23, 72, 103, 152, 183, 232, 248, 263, 312, 343, 392}, {24, 73, 104, 153, 184, 233, 249, 264, 313, 344, 393}, {25, 74, 105, 154, 185, 234, 250, 265, 314, 345, 394}, {26, 75, 106, 155, 186, 235, 251, 266, 315, 346, 395}, {27, 76, 107, 156, 187, 236, 252, 267, 316, 347, 396}, {28, 77, 108, 157, 188, 237, 253, 268, 317, 348, 397}, {29, 78, 109, 158, 189, 238, 254, 269, 318, 349, 398}, {30, 79, 110, 159, 190, 239, 255, 270, 319, 350, 399}, {31, 64, 111, 144, 191, 224, 240, 271, 304, 351, 384}, {16, 65, 96, 145, 176, 225, 241, 256, 305, 336, 385}, {17, 66, 97, 146, 177, 226, 242, 257, 306, 337, 386}, {18, 67, 98, 147, 178, 227, 243, 258, 307, 338, 387}, {19, 68, 99, 148, 179, 228, 244, 259, 308, 339, 388}, {20, 69, 100, 149, 180, 229, 245, 260, 309, 340, 389}, {21, 70, 101, 150, 181, 230, 246, 261, 310, 341, 390}, {14, 45, 94, 125, 174, 205, 254, 285, 334, 350, 365}, {15, 46, 95, 126, 175, 206, 255, 286, 335, 351, 366}, {0, 47, 80, 127, 160, 207, 240, 287, 320, 336, 367}, {1, 32, 81, 112, 161, 192, 241, 272, 321, 337, 352}, {2, 33, 82, 113, 162, 193, 242, 273, 322, 338, 353}, {3, 34, 83, 114, 163, 194, 243, 274, 323, 339, 354}, {4, 35, 84, 115, 164, 195, 244, 275, 324, 340, 355}, {5, 36, 85, 116, 165, 196, 245, 276, 325, 341, 356}, {6, 37, 86, 117, 166, 197, 246, 277, 326, 342, 357}, {7, 38, 87, 118, 167, 198, 247, 278, 327, 343, 358}, {8, 39, 88, 119, 168, 199, 248, 279, 328, 344, 359}, {9, 40, 89, 120, 169, 200, 249, 280, 329, 345, 360}, {10, 41, 90, 121, 170, 201, 250, 281, 330, 346, 361}, {11, 42, 91, 122, 171, 202, 251, 282, 331, 347, 362}, {12, 43, 92, 123, 172, 203, 252, 283, 332, 348, 363}, {13, 44, 93, 124, 173, 204, 253, 284, 333, 349, 364}} };

#define index(x, y, z) ((((x) % 5) + 5 * ((y) % 5)) * (width / 25) + ((z) % (width / 25)))
GRBEnv env = GRBEnv();
GRBModel model = GRBModel(env);
#define width 400
GRBVar x1[width], y1[width], z1[width], x2[width], y2[width], z2[width], x3[width], y3[width], z3[width], x4[width], y4[width], t0[width / 5][3], t1[width / 5][3], t2[width / 5][3], t3[width / 5][3], t4[width / 5][3];
const int ineqs_prob[6][8] = {{-3, -4, 1, 2, 2, 1, 3, 2}, {2, 4, -2, -2, -1, 1, -1, 0}, {-3, -4, 1, 4, -1, 2, 2, 4}, {2, 4, 0, -1, -2, -2, -1, 0}, {1, 3, -2, 0, 0, -1, -2, 1}, {-3, -4, 4, 1, 2, 2, 1, 2}};
const int ineqs_diff[26][11] = {{6, 6, 2, 7, 7, 0, -3, 5, -3, -1, 0}, {-3, -10, -10, 1, -3, 7, -10, -10, 2, -8, 44}, {7, -1, 1, -1, 7, -7, -1, -1, 6, -1, 5}, {4, 3, -10, -10, 2, -10, 7, -10, -6, 2, 36}, {1, -1, 7, 7, -1, -1, 6, -1, -7, -1, 5}, {0, -1, 9, -16, -4, 1, 15, 9, 18, 3, 2}, {3, -12, -12, 2, 4, 9, -12, -8, 2, -12, 44}, {27, -20, -3, 3, -1, -10, 20, -2, 10, 28, 6}, {1, -4, 2, -11, 22, 3, -7, 22, -11, 9, 22}, {-12, 2, 4, 3, -12, -8, 2, -12, 9, -12, 44}, {12, 0, -2, 1, -6, 5, 2, -4, 12, -6, 12}, {-10, -10, 1, -3, -3, -10, -10, 2, -8, 7, 44}, {-4, -9, 20, -1, 2, 32, 29, -19, 5, 11, 0}, {2, 31, -24, 1, -4, 29, -13, 22, 3, 11, 6}, {-11, -11, 3, 4, 2, -11, -7, 1, -11, 9, 40}, {1, -3, -3, -10, -10, 2, -8, 7, -10, -10, 44}, {-1, 1, -1, 7, 7, -1, -1, 6, -1, -7, 5}, {0, 0, -4, 3, -1, 4, 7, 7, -2, 1, 0}, {-1, -4, 4, 18, -19, 4, -4, 19, 2, 16, 8}, {2, 4, 3, -12, -12, 2, -12, 9, -12, -8, 44}, {-1, -1, -2, -2, 1, -2, 1, -2, -2, 0, 10}, {-1, 7, 7, -1, 1, 6, -1, -7, -1, -1, 5}, {-10, 1, -3, -3, -10, -10, 2, -8, 7, -10, 44}, {-24, 1, -4, 2, 31, 22, 3, 11, 29, -13, 6}, {-7, 16, -2, 2, -1, -7, 16, -1, -5, 16, 16}, {7, 7, -1, 1, -1, -1, -7, -1, -1, 6, 5}};
ofstream ofs;
void Handle_SIGINT(int sig)
{
    model.terminate();
}
void log(GRBVar output[width])
{
    for (int i = 0; i < 5; ++i)
    {
        for (int j = 0; j < 5; ++j)
        {
            ofs << "|";
            for (int k = width / 25 - 1; k >= 0; k -= 4)
            {
                int temp = 0;
                for (int kk = 0; kk < 4; ++kk)
                {
                    int ttemp = output[index(j, i, k - kk)].get(GRB_DoubleAttr_X);
                    temp += ttemp << (3 - kk);
                }
                if (temp == 0)
                    ofs << "-";
                else
                    ofs << hex << temp;
            }
        }
        ofs << "|" << endl;
    }
}
void log2(int output[width])
{
    for (int i = 0; i < 5; ++i)
    {
        for (int j = 0; j < 5; ++j)
        {
            cout << "|";
            for (int k = width / 25 - 1; k >= 0; k -= 4)
            {
                int temp = 0;
                for (int kk = 0; kk < 4; ++kk)
                {
                    int ttemp = output[index(j, i, k - kk)];
                    temp += ttemp << (3 - kk);
                }
                if (temp == 0)
                    cout << "-";
                else
                    cout << hex << temp;
            }
        }
        cout << "|" << endl;
    }
}
void log3(GRBVar output[width])
{
    for (int i = 0; i < 5; ++i)
    {
        for (int j = 0; j < 5; ++j)
        {
            ofs << "A[0x";
			ofs << (5 * i + j);
            ofs << "]=0x";
            for (int k = width / 25 - 1; k >= 0; k -= 4)
            {
                int temp = 0;
                for (int kk = 0; kk < 4; ++kk)
                {
                    int ttemp = output[index(j, i, k - kk)].get(GRB_DoubleAttr_X);
                    temp += ttemp << (3 - kk);
                }
                    ofs << hex << temp;
            }
            ofs << ";" << endl;
        }
    }
}

int main()
{
    signal(SIGINT, Handle_SIGINT);
    ios::sync_with_stdio(false);
	auto start = chrono::system_clock::now();
	try
	{
		//model.set(GRB_DoubleParam_TimeLimit, 1000);
		//model.set(GRB_DoubleParam_NoRelHeurTime, 60);
		//model.set(GRB_IntParam_OutputFlag, 0);
		model.set(GRB_IntParam_MIPFocus, 1);
		model.set(GRB_IntParam_Threads, 8);
		// t_r[i] models the i-th sbox of round r
		// if i-th sbox of round r is active, t_r[i][2] = 1
        // otherwise, t_r[i][2] = 0
        // t_r[i][0] and t_r[i][1] models the probability according to the DDT
        for (int i = 0; i < width / 5; ++i)
            for (int j = 0; j < 3; ++j)
            {
                t0[i][j] = model.addVar(0, 1, 0, GRB_BINARY);
                t1[i][j] = model.addVar(0, 1, 0, GRB_BINARY);
                t2[i][j] = model.addVar(0, 1, 0, GRB_BINARY);
                t3[i][j] = model.addVar(0, 1, 0, GRB_BINARY);
                t4[i][j] = model.addVar(0, 1, 0, GRB_BINARY);
            }

        // x_r models the state at the beginning of the round r
        // y_r models the state after linear layer(\theta,\rho,\pi) of the round r
        // z_r models the state after unlinear layer (\chi) of the round r
        for (int i = 0; i < width; ++i)
        {
            x1[i] = model.addVar(0, 1, 0, GRB_BINARY);
            y1[i] = model.addVar(0, 1, 0, GRB_BINARY);
            z1[i] = model.addVar(0, 1, 0, GRB_BINARY);
            x2[i] = model.addVar(0, 1, 0, GRB_BINARY);
            y2[i] = model.addVar(0, 1, 0, GRB_BINARY);
            z2[i] = model.addVar(0, 1, 0, GRB_BINARY);
            x3[i] = model.addVar(0, 1, 0, GRB_BINARY);
            y3[i] = model.addVar(0, 1, 0, GRB_BINARY);
            z3[i] = model.addVar(0, 1, 0, GRB_BINARY);
            x4[i] = model.addVar(0, 1, 0, GRB_BINARY);
            y4[i] = model.addVar(0, 1, 0, GRB_BINARY);
        }

        // optional
        // initialize a feasible solution
        int initialize_solution[width];


        for (int i = 0; i < width; ++i)
            initialize_solution[i] = 0;
        initialize_solution[index(0, 0, 0)] = 1;
        initialize_solution[index(0, 0, 7)] = 1;
        initialize_solution[index(1, 0, 14)] = 1;
        initialize_solution[index(1, 0, 15)] = 1;
        initialize_solution[index(2, 0, 10)] = 1;
        initialize_solution[index(4, 0, 1)] = 1;
        initialize_solution[index(4, 0, 9)] = 1;
        initialize_solution[index(1, 1, 15)] = 1;
        initialize_solution[index(2, 1, 2)] = 1;
        initialize_solution[index(2, 1, 10)] = 1;
        initialize_solution[index(4, 1, 0)] = 1;
        initialize_solution[index(4, 1, 1)] = 1;
        initialize_solution[index(4, 1, 9)] = 1;
        initialize_solution[index(4, 1, 14)] = 1;
        initialize_solution[index(1, 2, 15)] = 1;
        initialize_solution[index(2, 2, 2)] = 1;
        initialize_solution[index(4, 2, 0)] = 1;
        initialize_solution[index(4, 2, 1)] = 1;
        initialize_solution[index(0, 3, 7)] = 1;
        initialize_solution[index(1, 3, 15)] = 1;
        initialize_solution[index(2, 3, 2)] = 1;
        initialize_solution[index(2, 3, 10)] = 1;
        initialize_solution[index(4, 3, 0)] = 1;
        initialize_solution[index(4, 3, 1)] = 1;
        initialize_solution[index(4, 3, 9)] = 1;
        initialize_solution[index(4, 3, 14)] = 1;
        initialize_solution[index(1, 4, 14)] = 1;
        initialize_solution[index(1, 4, 15)] = 1;
        initialize_solution[index(2, 4, 2)] = 1;
        initialize_solution[index(2, 4, 10)] = 1;
        initialize_solution[index(3, 4, 1)] = 1;
        initialize_solution[index(4, 4, 0)] = 1;
        initialize_solution[index(4, 4, 9)] = 1;
        for (int i = 0; i < width; ++i)
        {
            y1[i].set(GRB_DoubleAttr_Start, initialize_solution[i]);
        }
		//for (int i = 0; i < width; i++)
		//	model.addConstr(y3[i], GRB_EQUAL, initialize_solution[i]);
        printf("y1=\n");
        log2(initialize_solution);

        for (int i = 0; i < width; ++i)
            initialize_solution[i] = 0;
        initialize_solution[index(0, 0, 7)] = 1;
        initialize_solution[index(0, 0, 15)] = 1;
        initialize_solution[index(2, 0, 5)] = 1;
        initialize_solution[index(4, 0, 15)] = 1;
        initialize_solution[index(0, 2, 15)] = 1;
        initialize_solution[index(0, 4, 0)] = 1;
        initialize_solution[index(1, 4, 0)] = 1;
        initialize_solution[index(1, 4, 5)] = 1;
        initialize_solution[index(2, 4, 0)] = 1;
        initialize_solution[index(2, 4, 5)] = 1;
        initialize_solution[index(3, 4, 0)] = 1;
        initialize_solution[index(4, 4, 0)] = 1;
        for (int i = 0; i < width; ++i)
        {
            y2[i].set(GRB_DoubleAttr_Start, initialize_solution[i]);
            //model.addConstr(y2[i], GRB_EQUAL, initialize_solution[i]);
        }
        printf("y2=\n");
        log2(initialize_solution);

        for (int i = 0; i < width; ++i)
            initialize_solution[i] = 0;
        initialize_solution[index(0, 0, 0)] = 1;
        initialize_solution[index(0, 0, 15)] = 1;
        initialize_solution[index(2, 0, 5)] = 1;
        initialize_solution[index(0, 2, 15)] = 1;
        initialize_solution[index(0, 4, 0)] = 1;
        initialize_solution[index(2, 4, 5)] = 1;
        for (int i = 0; i < width; ++i)
        {
            x3[i].set(GRB_DoubleAttr_Start, initialize_solution[i]);
            //model.addConstr(y5[i], GRB_EQUAL, initialize_solution[i]);
        }
        printf("x3=\n");
        log2(initialize_solution);

        for (int i = 0; i < width; ++i)
            initialize_solution[i] = 0;
        initialize_solution[index(0, 0, 3)] = 1;
        initialize_solution[index(4, 1, 2)] = 1;
        initialize_solution[index(4, 2, 2)] = 1;
        initialize_solution[index(0, 4, 3)] = 1;
        for (int i = 0; i < width; ++i)
        {
            x4[i].set(GRB_DoubleAttr_Start, initialize_solution[i]);
        }
        printf("x4=\n");
        log2(initialize_solution);

        // linear layer
        for (int i = 0; i < width; ++i)
        {
            // CP-kernel
            model.addConstr(y3[i], GRB_EQUAL, x3[linearlayer_CP[i]]);
            model.addConstr(y4[i], GRB_EQUAL, x4[linearlayer_CP[i]]);
            // without CP-kernel
            GRBVar temp = model.addVar(0, 5, 0, GRB_INTEGER);
            GRBLinExpr constr = -2 * temp;
            for (auto p : linearlayer[i])
                constr += x1[p];
            model.addConstr(constr, GRB_EQUAL, y1[i]);

            temp = model.addVar(0, 5, 0, GRB_INTEGER);
            constr = -2 * temp;
            for (auto p : linearlayer[i])
                constr += x2[p];
            model.addConstr(constr, GRB_EQUAL, y2[i]);
        }

        // CP-kernel constraints
        for (int i = 0; i < 5; ++i)
            for (int j = 0; j < width / 25; ++j)
            {
                GRBVar temp = model.addVar(0, 5, 0, GRB_INTEGER);
                GRBLinExpr constr = -2 * temp;
                for (int k = 0; k < 5; ++k)
                    constr += x3[index(i, k, j)];
                model.addConstr(constr, GRB_EQUAL, 0);

                temp = model.addVar(0, 5, 0, GRB_INTEGER);
                constr = -2 * temp;
                for (int k = 0; k < 5; ++k)
                    constr += x4[index(i, k, j)];
                model.addConstr(constr, GRB_EQUAL, 0);

            }

        // iota
        //RC[5]= 0x8001
        for (int i = 0; i < width; ++i)
        {
			if (i == 0 || i == 15)
                model.addConstr(x2[i] + z1[i], GRB_EQUAL, 1);
            else
                model.addConstr(x2[i], GRB_EQUAL, z1[i]);
        }

        // 0x0081
        for (int i = 0; i < width; ++i)
        {
            if (i == 0 || i == 7)
                model.addConstr(x3[i] + z2[i], GRB_EQUAL, 1);
            else
                model.addConstr(x3[i], GRB_EQUAL, z2[i]);
        }
        // 0x8009
        for (int i = 0; i < width; ++i)
        {
			if (i == 0 || i == 3 || i == 15 )
                model.addConstr(x4[i] + z3[i], GRB_EQUAL, 1);
            else
                model.addConstr(x4[i], GRB_EQUAL, z3[i]);
        }


        // unlinear layer (\chi)
        for (int i = 0; i < 5; ++i)
            for (int j = 0; j < width / 25; ++j)
            {
                // constraints between active sbox and input differences
                GRBLinExpr t1sum = 0, t2sum = 0, t3sum = 0, t4sum = 0;
                for (int k = 0; k < 5; ++k)
                {
                    t1sum += y1[index(k, i, j)];
                    t2sum += y2[index(k, i, j)];
                    t3sum += y3[index(k, i, j)];
                    t4sum += y4[index(k, i, j)];
                }
                model.addConstr(5 * t1[i * width / 25 + j][2], GRB_GREATER_EQUAL, t1sum);
                model.addConstr(5 * t2[i * width / 25 + j][2], GRB_GREATER_EQUAL, t2sum);
                model.addConstr(5 * t3[i * width / 25 + j][2], GRB_GREATER_EQUAL, t3sum);
                model.addConstr(5 * t4[i * width / 25 + j][2], GRB_GREATER_EQUAL, t4sum);
                model.addConstr(t1[i * width / 25 + j][2], GRB_LESS_EQUAL, t1sum);
                model.addConstr(t2[i * width / 25 + j][2], GRB_LESS_EQUAL, t2sum);
                model.addConstr(t3[i * width / 25 + j][2], GRB_LESS_EQUAL, t3sum);
                model.addConstr(t4[i * width / 25 + j][2], GRB_LESS_EQUAL, t4sum);

                // constraints between input differences and output differences without probabilities
                for (int k = 0; k < 26; ++k)
                {
                    GRBLinExpr constr_diff = ineqs_diff[k][10];
                    for (int p = 0; p < 5; ++p)
                        constr_diff += ineqs_diff[k][p] * z1[index(4 - p, i, j)] + ineqs_diff[k][p + 5] * y1[index(4 - p, i, j)];
                    model.addConstr(constr_diff, GRB_GREATER_EQUAL, 0);

                    constr_diff = ineqs_diff[k][10];
                    for (int p = 0; p < 5; ++p)
                        constr_diff += ineqs_diff[k][p] * z2[index(4 - p, i, j)] + ineqs_diff[k][p + 5] * y2[index(4 - p, i, j)];
                    model.addConstr(constr_diff, GRB_GREATER_EQUAL, 0);

                    constr_diff = ineqs_diff[k][10];
                    for (int p = 0; p < 5; ++p)
                        constr_diff += ineqs_diff[k][p] * z3[index(4 - p, i, j)] + ineqs_diff[k][p + 5] * y3[index(4 - p, i, j)];
                    model.addConstr(constr_diff, GRB_GREATER_EQUAL, 0);
                }

                // constraints between input differences and probabilities (probabilities only depend on the input differences)
                for (int k = 0; k < 6; ++k)
                {
                    GRBLinExpr constr_prob = t1[width / 25 * i + j][0] * ineqs_prob[k][0] + t1[width / 25 * i + j][1] * ineqs_prob[k][1] + ineqs_prob[k][7];
                    for (int p = 0; p < 5; ++p)
                        constr_prob += ineqs_prob[k][p + 2] * y1[index(4 - p, i, j)];
                    model.addConstr(constr_prob, GRB_GREATER_EQUAL, 0);

                    constr_prob = t2[width / 25 * i + j][0] * ineqs_prob[k][0] + t2[width / 25 * i + j][1] * ineqs_prob[k][1] + ineqs_prob[k][7];
                    for (int p = 0; p < 5; ++p)
                        constr_prob += ineqs_prob[k][p + 2] * y2[index(4 - p, i, j)];
                    model.addConstr(constr_prob, GRB_GREATER_EQUAL, 0);

                    constr_prob = t3[width / 25 * i + j][0] * ineqs_prob[k][0] + t3[width / 25 * i + j][1] * ineqs_prob[k][1] + ineqs_prob[k][7];
                    for (int p = 0; p < 5; ++p)
                        constr_prob += ineqs_prob[k][p + 2] * y3[index(4 - p, i, j)];
                    model.addConstr(constr_prob, GRB_GREATER_EQUAL, 0);

                    constr_prob = t4[width / 25 * i + j][0] * ineqs_prob[k][0] + t4[width / 25 * i + j][1] * ineqs_prob[k][1] + ineqs_prob[k][7];
                    for (int p = 0; p < 5; ++p)
                        constr_prob += ineqs_prob[k][p + 2] * y4[index(4 - p, i, j)];
                    model.addConstr(constr_prob, GRB_GREATER_EQUAL, 0);
                }
            }

        GRBLinExpr k2, k3, k4, k5;
        for (int i = 0; i < width / 5; ++i)
        {
            k2 += t1[i][0] + t1[i][1] * 2 + t1[i][2];
            k3 += t2[i][0] + t2[i][1] * 2 + t2[i][2];
            k4 += t3[i][0] + t3[i][1] * 2 + t3[i][2];
            k5 += t4[i][0] + t4[i][1] * 2 + t4[i][2];
        }
        auto k2value = model.addVar(0, width, 0, GRB_INTEGER);
        model.addConstr(k2, GRB_EQUAL, k2value);
        auto k3value = model.addVar(0, width, 0, GRB_INTEGER);
        model.addConstr(k3, GRB_EQUAL, k3value);
        auto k4value = model.addVar(0, width, 0, GRB_INTEGER);
        model.addConstr(k4, GRB_EQUAL, k4value);
        auto k5value = model.addVar(0, width, 0, GRB_INTEGER);
        model.addConstr(k5, GRB_EQUAL, k5value);
        //model.addConstr(k2, GRB_LESS_EQUAL, 16);
		model.setObjective(2 * k2 + 2 * k3 + 2 * k4 + k5, GRB_MINIMIZE);
        //model.setObjective(k2 + k3 + k4, GRB_MINIMIZE);
        //model.setObjective(k2, GRB_MINIMIZE);

        model.update();
        //model.write("5r200.mps");
		model.optimize();
		ofs.open("6rkeccak800.txt");
        ofs << "x1:" << endl;
        log(x1);
        ofs << "y1:" << endl;
        log(y1);
        ofs << "z1:" << endl;
        log(z1);
        ofs << "x2:" << endl;
        log(x2);
        ofs << "y2:" << endl;
        log(y2);
        ofs << "z2:" << endl;
        log(z2);
        ofs << "x3:" << endl;
        log(x3);
        ofs << "y3:" << endl;
        log(y3);
        ofs << "z3:" << endl;
        log(z3);
        ofs << "x4:" << endl;
        log(x4);
        ofs << "y4:" << endl;
        log(y4);

        ofs << "x1:" << endl;
        log3(x1);
        ofs << "y1:" << endl;
        log3(y1);
        ofs << "z1:" << endl;
        log3(z1);
        ofs << "x2:" << endl;
        log3(x2);
        ofs << "y2:" << endl;
        log3(y2);
        ofs << "z2:" << endl;
        log3(z2);
        ofs << "x3:" << endl;
        log3(x3);
        ofs << "y3:" << endl;
        log3(y3);
        ofs << "z3:" << endl;
        log3(z3);
        ofs << "x4:" << endl;
        log3(x4);
        ofs << "y4:" << endl;
        log3(y4);

        ofs.close();
        std::cout << "k2:" << k2value.get(GRB_DoubleAttr_X) << endl;
        std::cout << "k3:" << k3value.get(GRB_DoubleAttr_X) << endl;
        std::cout << "k4:" << k4value.get(GRB_DoubleAttr_X) << endl;
        std::cout << "k5:" << k5value.get(GRB_DoubleAttr_X) << endl;

    }
    catch (GRBException e)
    {
        std::cout << "Error code = " << e.getErrorCode() << endl;
        std::cout << e.getMessage() << endl;
    }
    auto end = chrono::system_clock::now();
    auto duration = chrono::duration_cast<chrono::microseconds>(end - start);
    std::cout << double(duration.count()) * chrono::microseconds::period::num /
                     chrono::microseconds::period::den
              << "s" << endl;
    return 0;
}